<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><!DOCTYPE html>
        <html lang="zh-CN">
        <head>
        <meta charset="UTF-8">
        <title>å¾®ä¿¡ JS-SDK åˆå§‹åŒ–éªŒè¯</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- å¾®ä¿¡ JS-SDK -->
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
</head>
<body>

<h2>å¾®ä¿¡ JS-SDK åˆå§‹åŒ–æµ‹è¯•</h2>
<button id="btn">æµ‹è¯• scanQRCode</button>

<script>
    // 1. å½“å‰é¡µé¢ URLï¼ˆå»æ‰ #ï¼‰
    const url = location.href.split('#')[0]

    // 2. è¯·æ±‚åå°ç”Ÿæˆé…ç½®
    fetch('http://123.60.83.68:8788/mine/wechat/wx/js-sdk-config?url=' + encodeURIComponent(url))
        .then(res => res.json())
        .then(cfg => {
            console.log('js-sdk config from backend:', cfg)

            // 3. åˆå§‹åŒ– wx.config
            wx.config({
                debug: true, // è°ƒè¯•é˜¶æ®µå»ºè®® true
                appId: cfg.appId,
                timestamp: cfg.timestamp,
                nonceStr: cfg.nonceStr,
                signature: cfg.signature,
                jsApiList: [
                    'scanQRCode'
                ]
            })
        })
        .catch(err => {
            alert('è·å– js-sdk-config å¤±è´¥')
            console.error(err)
        })

    // 4. åˆå§‹åŒ–æˆåŠŸ
    wx.ready(function () {
        alert('wx.config åˆå§‹åŒ–æˆåŠŸ ğŸ‰')

        document.getElementById('btn').onclick = function () {
            wx.scanQRCode({
                needResult: 1,
                scanType: ['qrCode', 'barCode'],
                success: function (res) {
                    alert('æ‰«ç ç»“æœï¼š' + res.resultStr)
                }
            })
        }
    })

    // 5. åˆå§‹åŒ–å¤±è´¥
    wx.error(function (err) {
        alert('wx.config åˆå§‹åŒ–å¤±è´¥ âŒ')
        console.error('wx.error:', err)
    })
</script>

</body>
</html>
</title>
</head>
<body>

</body>
</html>